<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="animatedTitle">h</title>
    <link rel="stylesheet" href="css/x.css">
    <meta property="og:type" content="website">
    <meta property="og:title" content="harm">
    <meta property="og:description" content="#exile">
    <meta property="og:url" content="https://harm.pw">
    <meta name="theme-color" content="#000000">

    <!-- Tailwind CSS for styling the counter -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM for the counter component -->
    <script src="https://unpkg.com/react/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>

    <style>
        /* Font Import:
            1. Download 'MinecraftStandard.otf' (or 'Minecrafter.ttf').
            2. Create a 'fonts' folder.
            3. Place the font file inside.
        */
        @font-face {
            font-family: 'MinecraftStandard';
            src: url('fonts/MinecraftStandard.otf') format('opentype'); /* Updated format */
            font-weight: normal;
            font-style: normal;
        }

        body {
            margin: 0;
            overflow-x: hidden; /* Prevent horizontal scrollbar */
            position: relative; /* To allow absolute positioning of the overlay relative to the body */
            min-height: 100vh; /* Ensure the body takes at least the full viewport height */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            display: flex;
            flex-direction: column; /* Allow footer to stick to the bottom */
            align-items: center; /* Center the content horizontally */
        }

        center {
            width: 100%; /* Take full width within the flex container */
            text-align: center; /* Keep video centered */
            margin-bottom: auto; /* Push the footer to the bottom */
        }

        video {
            display: block;
            margin: 20px auto; /* Add some top margin and center */
            max-width: 55%;
            height: auto;
        }

        #overlay-text {
            position: absolute;
            bottom: 0; /* Stick to the very bottom */
            left: 0;
            width: 100%; /* Make it full width */
            background-color: rgba(0, 0, 0, 0.7); /* Slightly more opaque background */
            color: white;
            padding: 10px 0; /* Adjust vertical padding, remove horizontal */
            text-align: center; /* Center the text horizontally */
            font-family: 'MinecraftStandard', monospace, sans-serif;
            font-size: clamp(1em, 3vw, 1.5em); /* Adjust font size for bottom placement */
            white-space: nowrap; /* Prevent wrapping */
            z-index: 10;

            /* Smoother Glowing Ripple Effect */
            background: linear-gradient(90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.6) 30%, /* Adjusted stop */
                rgba(255, 255, 255, 1) 50%,
                rgba(255, 255, 255, 0.6) 70%, /* Adjusted stop */
                rgba(255, 255, 255, 0) 100%
            );
            background-size: 200% 100%; /* Slightly reduce size for smoother effect */
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-fill-color: transparent;
            animation: glowRipple 6s infinite linear; /* Slower animation for smoother look */
        }

        /* --- New styles for the #exile button --- */
        #exile-button {
            display: block; /* Make it a block element to center with margin auto */
            margin: 20px auto 0 auto; /* Top margin, auto horizontal margin for centering */
            text-decoration: none; /* Remove underline from link */
            color: white; /* Default text color before glow */
            padding: 10px 20px;
            background-color: rgba(0, 0, 0, 0.7);
            font-family: 'MinecraftStandard', monospace, sans-serif;
            font-size: clamp(1.2em, 4vw, 2em); /* Adjust size as needed */
            white-space: nowrap;
            z-index: 10;
            border: none; /* Remove default button border */
            cursor: pointer; /* Indicate it's clickable */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */

            /* Apply the same glowing ripple effect */
            background: linear-gradient(90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.6) 30%,
                rgba(255, 255, 255, 1) 50%,
                rgba(255, 255, 255, 0.6) 70%,
                rgba(255, 255, 255, 0) 100%
            );
            background-size: 200% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-fill-color: transparent;
            animation: glowRipple 6s infinite linear;
        }
        /* --- End of new styles --- */

        @keyframes glowRipple {
            0% {
                background-position: -100% 0; /* Start off-screen */
            }
            100% {
                background-position: 200% 0; /* Move across */
            }
        }

        /* Custom styles for the view counter container */
        #view-counter-container {
            position: fixed; /* Fixed position relative to the viewport */
            bottom: 10px; /* 10px from the bottom */
            left: 10px; /* 10px from the left */
            z-index: 20; /* Ensure it's above other content */
            font-family: 'MinecraftStandard', monospace, sans-serif; /* Use your custom font */
            color: white; /* White text color */
            background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent background */
            padding: 8px 12px; /* Padding around the text */
            border-radius: 8px; /* Slightly rounded corners */
            font-size: 1em; /* Base font size */
            display: flex;
            align-items: center;
            gap: 8px; /* Space between icon and text */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5); /* Subtle shadow */
            white-space: nowrap; /* Prevent wrapping */
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); /* Subtle text glow */
        }

        #view-counter-container .counter-text {
            font-size: 1.2em; /* Slightly larger for the number */
            font-weight: bold;
        }
    </style>
</head>
<body>
    <a href="https://harm.pw/exile" id="exile-button">#exile</a>
    <center>
        <video id="x" width="55%" controls=""></video>
    </center>
    <div id="overlay-text">Â© est. 2024 @ exile.</div>

    <!-- Div where the React view counter will be mounted -->
    <div id="view-counter-root"></div>

    <script src="js/x.js"></script>

    <!-- React App component for the view counter -->
    <script type="module">
        // Firebase SDKs (modular imports)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Define the React App component directly within the HTML script
        const App = () => {
            // State variables to hold Firebase instances and user ID
            const [db, setDb] = React.useState(null);
            const [auth, setAuth] = React.useState(null);
            const [userId, setUserId] = React.useState(null);
            const [viewCount, setViewCount] = React.useState(0);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);

            // Initialize Firebase and handle authentication
            React.useEffect(() => {
                try {
                    // Retrieve Firebase configuration from global variable
                    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
                    // Retrieve app ID from global variable
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

                    // Initialize Firebase app
                    const app = initializeApp(firebaseConfig);
                    // Get Firestore and Auth instances
                    const firestore = getFirestore(app);
                    const firebaseAuth = getAuth(app);

                    setDb(firestore);
                    setAuth(firebaseAuth);

                    // Sign in with custom token if available, otherwise anonymously
                    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                    if (initialAuthToken) {
                        signInWithCustomToken(firebaseAuth, initialAuthToken)
                            .then(() => console.log('Signed in with custom token'))
                            .catch((err) => {
                                console.error('Error signing in with custom token:', err);
                                signInAnonymously(firebaseAuth)
                                    .then(() => console.log('Signed in anonymously after custom token failure'))
                                    .catch((anonErr) => setError(`Authentication error: ${anonErr.message}`));
                            });
                    } else {
                        signInAnonymously(firebaseAuth)
                            .then(() => console.log('Signed in anonymously'))
                            .catch((anonErr) => setError(`Authentication error: ${anonErr.message}`));
                    }

                    // Listen for authentication state changes
                    const unsubscribeAuth = onAuthStateChanged(firebaseAuth, (user) => {
                        if (user) {
                            // Set the user ID once authenticated
                            setUserId(user.uid);
                            setLoading(false);
                        } else {
                            setUserId(null);
                            setLoading(false);
                        }
                    });

                    // Cleanup function for auth listener
                    return () => unsubscribeAuth();
                } catch (err) {
                    console.error("Firebase initialization error:", err);
                    setError(`Initialization error: ${err.message}`);
                    setLoading(false);
                }
            }, []); // Empty dependency array ensures this runs only once on mount

            // Effect to handle view count increment and real-time updates
            React.useEffect(() => {
                // Ensure db and userId are available before proceeding
                if (!db || !userId) {
                    return;
                }

                // Define the path to the public view count document
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const viewCountDocRef = doc(db, `artifacts/${appId}/public/data/viewCounts`, 'websiteViews');

                // Function to increment the view count
                const incrementView = async () => {
                    try {
                        const docSnap = await getDoc(viewCountDocRef);
                        let currentCount = 0;
                        if (docSnap.exists()) { // For v9+, docSnap.exists() is a method
                            currentCount = docSnap.data().count || 0;
                        }
                        const newCount = currentCount + 1;
                        await setDoc(viewCountDocRef, { count: newCount }, { merge: true });
                        console.log('View count incremented to:', newCount);
                    } catch (err) {
                        console.error('Error incrementing view count:', err);
                        setError(`Failed to update view count: ${err.message}`);
                    }
                };

                // Increment view count on component mount (first load)
                incrementView();

                // Set up a real-time listener for the view count
                const unsubscribeSnapshot = onSnapshot(viewCountDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        setViewCount(data.count || 0);
                    } else {
                        setViewCount(0);
                    }
                }, (err) => {
                    console.error('Error listening to view count:', err);
                    setError(`Real-time update error: ${err.message}`);
                });

                // Cleanup function for the snapshot listener
                return () => unsubscribeSnapshot();
            }, [db, userId]); // Re-run if db or userId changes

            // Render loading, error, or the view counter
            if (loading) {
                return <div className="text-white text-sm">Loading...</div>;
            }

            if (error) {
                return <div className="text-red-400 text-sm">Error: {error}</div>;
            }

            return (
                <div id="view-counter-container">
                    {/* Eye icon using SVG for a small, clear graphic */}
                    <svg className="w-5 h-5 text-blue-300" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                        <path fillRule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clipRule="evenodd"></path>
                    </svg>
                    <span className="counter-text">{viewCount}</span>
                    {/* Optionally display user ID for debugging/identification, can be removed */}
                    {/* {userId && (
                        <span className="text-xs text-gray-400 ml-2">(ID: {userId.substring(0, 4)}...)</span>
                    )} */}
                </div>
            );
        };

        // Render the React App component into the 'view-counter-root' div
        ReactDOM.render(<App />, document.getElementById('view-counter-root'));
    </script>
</body>
</html>
